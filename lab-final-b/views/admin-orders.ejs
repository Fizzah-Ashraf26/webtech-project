<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<%- include('partials/header') %>

<div class="container py-5">
  <h1 class="mb-4">All Orders</h1>

  <% if (orders && orders.length) { %>
    <table class="table table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Total (Rs.)</th>
          <th>Discounted Total (if any)</th>
          <th>Status</th>
          <th>Update Status</th>
          <th>View Details</th>
        </tr>
      </thead>
      <tbody>
        <% orders.forEach(order => { %>
          <tr>
            <td><%= order._id %></td>
            <td><%= order.customer ? order.customer.fullName : 'N/A' %></td>
            <td><%= order.createdAt.toLocaleString() %></td>
            <td><%= order.totalAmount %></td>
            <td>
              <% if (order.discount && order.discount.total) { %>
                <%= order.discount.total %>
              <% } else { %>
                -
              <% } %>
            </td>
            <td><%= order.status %></td>
            <td>
              <% if (order.status !== 'Delivered') { %>
                <form action="/admin/orders/<%= order._id %>/status" method="POST" class="d-flex">
                  <select name="newStatus" class="form-select form-select-sm me-2" required>
                    <% if (order.status === 'Placed') { %>
                      <option value="Processing">Processing</option>
                    <% } else if (order.status === 'Processing') { %>
                      <option value="Delivered">Delivered</option>
                    <% } %>
                  </select>
                  <button type="submit" class="btn btn-sm btn-success">Update</button>
                </form>
              <% } else { %>
                <span class="text-success">Delivered</span>
              <% } %>
            </td>
            <td>
              <a href="/order/success/<%= order._id %>" class="btn btn-sm btn-info">View</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>No orders found.</p>
  <% } %>
</div>

<footer class="mt-5">
  <%- include('partials/footer') %>
</footer>
</body>
</html>
